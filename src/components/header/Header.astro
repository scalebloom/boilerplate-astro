---
import "./header.css";
import Logo from "../logo.astro";
---

<header>
  <div class="header-inner-container">
    <!-- Logo -->
    <a
      class="header-logo-link-wrapper"
      href="/"
      rel="home"
      aria-current="page"
      aria-label="Home"
    >
      <Logo />
    </a>
    <!-- Header col 2 -->
    <div class="header-col-2">
      <!-- Nav Toggle Button-->
      <button
        type="button"
        id="nav-toggle"
        aria-label="Toggle navigation menu"
        aria-expanded="false"
      >
        <span class="nav-toggle-icon" aria-hidden="true">
          <span class="nav-toggle-bar"></span>
          <span class="nav-toggle-bar"></span>
        </span>
      </button>
      <!-- Nav -->
      <nav id="header-nav">
        <ul class="nav-list">
          <li class="nav-list-item">
            <a href="/" class="nav-link">Home</a>
          </li>
          <li class="nav-list-item has-submenu">
            <details>
              <summary class="nav-link">
                About
                <svg aria-hidden="true"
                  ><use href="/sprite.svg#icon-arrow-down"></use></svg
                >
              </summary>
              <ul class="sub-nav-list">
                <li>
                  <a href="#" class="sub-nav-link">
                    <svg class="sub-nav-link-icon" aria-hidden="true"
                      ><use href="/sprite.svg#icon-groups"></use></svg
                    >
                    <span class="sub-nav-texts-col"
                      ><span class="sub-nav-title">Sub nav link</span>
                      <span class="sub-nav-description"
                        >Sub nav description</span
                      ></span
                    >
                  </a>
                </li>
                <li>
                  <a href="#" class="sub-nav-link">
                    <svg class="sub-nav-link-icon" aria-hidden="true"
                      ><use href="/sprite.svg#icon-groups"></use></svg
                    >
                    <span class="sub-nav-texts-col"
                      ><span class="sub-nav-title">Sub nav link</span>
                      <span class="sub-nav-description"
                        >Sub nav description</span
                      ></span
                    >
                  </a>
                </li>
                <li>
                  <a href="#" class="sub-nav-link">
                    <svg class="sub-nav-link-icon" aria-hidden="true"
                      ><use href="/sprite.svg#icon-groups"></use></svg
                    >
                    <span class="sub-nav-texts-col"
                      ><span class="sub-nav-title">Sub nav link</span>
                      <span class="sub-nav-description"
                        >Sub nav description</span
                      ></span
                    >
                  </a>
                </li>
                <li>
                  <a href="#" class="sub-nav-link">
                    <svg class="sub-nav-link-icon" aria-hidden="true"
                      ><use href="/sprite.svg#icon-groups"></use></svg
                    >
                    <span class="sub-nav-texts-col"
                      ><span class="sub-nav-title">Sub nav link</span>
                      <span class="sub-nav-description"
                        >Sub nav description</span
                      ></span
                    >
                  </a>
                </li>
                <li>
                  <a href="#" class="sub-nav-link">
                    <svg class="sub-nav-link-icon" aria-hidden="true"
                      ><use href="/sprite.svg#icon-groups"></use></svg
                    >
                    <span class="sub-nav-texts-col"
                      ><span class="sub-nav-title">Sub nav link</span>
                      <span class="sub-nav-description"
                        >Sub nav description</span
                      ></span
                    >
                  </a>
                </li>
              </ul>
            </details>
          </li>
          <li class="nav-list-item">
            <a href="/#services/" class="nav-link">Services</a>
          </li>
          <li class="nav-list-item">
            <a href="/careers/" class="nav-link">Careers</a>
          </li>
        </ul>
        <a href="/contact/" class="nav-link-cta-primary">Get in touch</a>
        <button id="theme-toggle" type="button" aria-label="Toggle theme">
          <svg><use href="/sprite.svg#icon-dark-mode"></use></svg>
        </button>
      </nav>
    </div>
  </div>
</header>

<script>
  import { initializeThemeToggle } from "../theme-toggle.js";

  // Initialize theme toggle
  initializeThemeToggle();

  const navToggle = document.getElementById("nav-toggle")!;
  const nav = document.getElementById("header-nav")!;
  const header = document.querySelector("header")!;

  // Helper to close mobile nav
  const closeNav = () => {
    nav.classList.remove("nav-open");
    navToggle.setAttribute("aria-expanded", "false");
  };

  // Helper to close all open submenus
  const closeSubmenus = () => {
    nav.querySelectorAll("details[open]").forEach((d) => {
      d.removeAttribute("open");
    });
  };

  // Toggle mobile nav on button click
  navToggle.addEventListener("click", () => {
    const isOpen = nav.classList.toggle("nav-open");
    navToggle.setAttribute("aria-expanded", String(isOpen));
  });

  // Close nav and submenus when clicking outside
  document.addEventListener("click", (e) => {
    const target = e.target as HTMLElement;
    if (target.closest("#nav-toggle")) return;

    const clickedInNav = target.closest("#header-nav");
    if (!clickedInNav && nav.classList.contains("nav-open")) closeNav();
    if (!target.closest("details")) closeSubmenus();
  });

  // Close nav and submenus on Escape key
  document.addEventListener("keydown", (e) => {
    if (e.key !== "Escape") return;
    closeNav();
    closeSubmenus();
  });

  // Add scrolled class to header when scrolling
  let isScrolled = false;
  window.addEventListener(
    "scroll",
    () => {
      const shouldBeScrolled = window.scrollY > 50;
      if (isScrolled !== shouldBeScrolled) {
        isScrolled = shouldBeScrolled;
        header.classList.toggle("scrolled", isScrolled);
      }
    },
    { passive: true },
  );
</script>
