---
import "./header.css";
import Logo from "../logo.astro";
---

<header>
  <div class="header-inner-container">
    <!-- Logo -->
    <a
      class="header-logo-link-wrapper"
      href="/"
      rel="home"
      aria-current="page"
      aria-label="Home"
    >
      <Logo />
    </a>
    <!-- Header col 2 -->
    <div class="header-col-2">
      <!-- Nav Toggle Button-->
      <button
        type="button"
        popovertarget="header-nav"
        class="nav-toggle"
        aria-label="Toggle navigation menu"
        aria-expanded="false"
      >
        <span class="nav-toggle-icon" aria-hidden="true">
          <span class="nav-toggle-bar"></span>
          <span class="nav-toggle-bar"></span>
        </span>
      </button>
      <!-- Nav -->
      <nav id="header-nav" popover>
        <ul class="nav-list">
          <li class="nav-list-item">
            <a href="/" class="nav-link">Home</a>
          </li>
          <li class="nav-list-item has-submenu">
            <details>
              <summary class="nav-link">
                About
                <svg aria-hidden="true"
                  ><use href="/sprite.svg#icon-arrow-down"></use></svg
                >
              </summary>
              <ul class="sub-nav-list">
                <li>
                  <a href="#" class="sub-nav-link">
                    <svg class="sub-nav-link-icon" aria-hidden="true"
                      ><use href="/sprite.svg#icon-groups"></use></svg
                    >
                    <span class="sub-nav-texts-col"
                      ><span class="sub-nav-title">Sub nav link</span>
                      <span class="sub-nav-description"
                        >Sub nav description</span
                      ></span
                    >
                  </a>
                </li>
                <li>
                  <a href="#" class="sub-nav-link">
                    <svg class="sub-nav-link-icon" aria-hidden="true"
                      ><use href="/sprite.svg#icon-groups"></use></svg
                    >
                    <span class="sub-nav-texts-col"
                      ><span class="sub-nav-title">Sub nav link</span>
                      <span class="sub-nav-description"
                        >Sub nav description</span
                      ></span
                    >
                  </a>
                </li>
                <li>
                  <a href="#" class="sub-nav-link">
                    <svg class="sub-nav-link-icon" aria-hidden="true"
                      ><use href="/sprite.svg#icon-groups"></use></svg
                    >
                    <span class="sub-nav-texts-col"
                      ><span class="sub-nav-title">Sub nav link</span>
                      <span class="sub-nav-description"
                        >Sub nav description</span
                      ></span
                    >
                  </a>
                </li>
                <li>
                  <a href="#" class="sub-nav-link">
                    <svg class="sub-nav-link-icon" aria-hidden="true"
                      ><use href="/sprite.svg#icon-groups"></use></svg
                    >
                    <span class="sub-nav-texts-col"
                      ><span class="sub-nav-title">Sub nav link</span>
                      <span class="sub-nav-description"
                        >Sub nav description</span
                      ></span
                    >
                  </a>
                </li>
                <li>
                  <a href="#" class="sub-nav-link">
                    <svg class="sub-nav-link-icon" aria-hidden="true"
                      ><use href="/sprite.svg#icon-groups"></use></svg
                    >
                    <span class="sub-nav-texts-col"
                      ><span class="sub-nav-title">Sub nav link</span>
                      <span class="sub-nav-description"
                        >Sub nav description</span
                      ></span
                    >
                  </a>
                </li>
              </ul>
            </details>
          </li>
          <li class="nav-list-item">
            <a href="/#services/" class="nav-link">Services</a>
          </li>
          <li class="nav-list-item">
            <a href="/careers/" class="nav-link">Careers</a>
          </li>
        </ul>
        <a href="/contact/" class="nav-link-cta-primary">Get in touch</a>
        <button id="theme-toggle" type="button" aria-label="Toggle theme">
          <svg><use href="/sprite.svg#icon-dark-mode"></use></svg>
        </button>
      </nav>
    </div>
  </div>
</header>

<script>
  import { initializeThemeToggle } from "../theme-toggle.js";

  // Initialize theme toggle
  initializeThemeToggle();

  // Set aria-expanded for accessibility (screen readers)
  // Note: The hamburger animation is handled purely by CSS using :has() and :popover-open
  // This script only manages the aria-expanded attribute for assistive technologies
  const navToggle = document.querySelector('[popovertarget="header-nav"]')!;
  const nav = document.getElementById("header-nav")!;
  const header = document.querySelector("header")!;

  nav.addEventListener("toggle", (e) => {
    navToggle.setAttribute(
      "aria-expanded",
      String((e as ToggleEvent).newState === "open"),
    );
  });

  // Close submenus when clicking outside
  document.addEventListener("click", (e) => {
    if (!document.querySelector("#header-nav details[open]")) return;
    const target = e.target as HTMLElement;
    if (!target.closest("details")) {
      document.querySelectorAll("#header-nav details[open]").forEach((d) => {
        d.removeAttribute("open");
      });
    }
  });

  // Close submenus on Escape key
  document.addEventListener("keydown", (e) => {
    if (e.key !== "Escape") return;
    document.querySelectorAll("#header-nav details[open]").forEach((d) => {
      d.removeAttribute("open");
    });
  });

  // Add scrolled class to header when scrolling
  window.addEventListener("scroll", () => {
    header.classList.toggle("scrolled", window.scrollY > 50);
  });
</script>
